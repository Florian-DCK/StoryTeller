<form action="/addParticipation?storyId={{story.id}}" method="POST" class="h-1/2 w-full px-12 flex items-center gap-4 my-auto relative">
    <!-- -------------------- -->
    <!-- Upload image section -->
    <!-- -------------------- -->
    <div class=" h-full w-2/6 border flex flex-col items-center px-6">
            <div class="h-1/5 flex flex-col justify-center gap-1">
                <h1 class="font-family-joan font-bold text-4xl text-center">Illustrez</h1>
                <div class="w-1/2 h-0.5 bg-black mx-auto"></div>
            </div>
            <label for="image" class="border-4 border-black border-double w-full h-3/5 relative mb-1 text-faded-text  hover:bg-faded-text hover:text-black transition duration-300 ease-in-out flex flex-col justify-center items-center gap-2">Uploader une image
                <input type="file" name="image" placeholder="Uploader une image" class="text-transparent absolute w-full h-full cursor-pointer" >
            </label>
            <p class="text-center text-faded-text">
                Uploader une image n'est pas obligatoire mais elle peut aider à illustrer votre histoire.
            </p>
    </div>
    <!-- -------------------- -->
    <!-- Writing section -->
    <!-- -------------------- -->
    <div class="h-full w-4/6 border px-6 relative">
        <div class="h-1/5 flex flex-col justify-center gap-1">
            <div class="flex justify-center items-center gap-2 w-fit mx-auto">
                <h1 id="story-title" name="title" class="font-family-joan font-bold w-fit text-4xl text-center">{{story.title}} </h1>
            </div>
            <div class="w-1/4 h-0.5 bg-black mx-auto"></div>
        </div>
        <!--  -->
        <div class="h-4/5 flex shrink-0">
            <textarea name="participation" id="newstory" class="border resize-none h-4/5 w-3/4 px-2" placeholder="Ecrivez la suite de l'histoire"></textarea>
            <div class="h-4/5 flex items-center gap-2">
                <div class="bg-black w-0.5 h-3/5 mx-2"></div>
                <p>John Doe</p>
                <div class="w-10 aspect-square rounded-full bg-borders"></div>
            </div>
        </div>
        <p class="absolute bottom-2 right-2 text-faded-text">0/1000</p>
    </div>
    <!-- -------------------- -->
    <!-- Metadata section -->
    <!-- -------------------- -->
    <div class=" min-h-full w-2/6 border px-6 py-4">
        <div class="h-1/5 flex flex-col justify-center gap-1">
            <h1 class="font-family-joan font-bold text-4xl text-center">Thèmes de l'histoire</h1>
            <div class="w-1/2 h-0.5 bg-black mx-auto"></div>
        </div>
        <!--  Genre section   -->
        <div class="h-2/5 mt-2">
            <div class="flex flex-col  w-1/2 mb-2">
                <h2 class="font-family-joan">Genre(s)</h2>
                <div class="bg-black w-1/3 h-0.5"></div>
            </div>
            <ul class="flex flex-wrap items-center gap-2 gap-y-5 mb-4 ps-2 py-2">
                {{#themes}}
                    <li>
                        <input type="checkbox" name="genres[]" id="{{.}}" value="{{.}}" class="hidden peer">
                        <label for="{{.}}" class="font-family-joan text-faded-text peer-checked:text-black peer-checked:border-black border border-faded-text p-1 py-1.5 cursor-pointer select-none">{{.}}</label>
                    </li>
                {{/themes}}
                
            </ul>
        </div>
    </div>
    <!-- -------------------- -->
    <!-- Submit button section -->
    <!-- -------------------- -->
    <button type="submit" class=" w-fit px-4 py-2 cursor-pointer hover:bg-faded-text transition duration-300 absolute -bottom-16 left-1/2 -translate-x-1/2 border-4 border-double font-family-joan">Valider</button>
</form>

<script>
    const input = document.querySelector("#tags");
    const taglist = document.querySelector("#taglist");
    const tagbutton = document.querySelector("#tagbutton");
    const hiddenTagContainer = document.querySelector("#hidden-tag-container");
    const maxTags = 5; // Maximum number of tags allowed
    const maxTagLength = 20; // Maximum length of each tag

    function addTag() {
        const tagText = input.value.trim();
        if (tagText && taglist.children.length < maxTags && tagText.length <= maxTagLength) {
            // Create visible tag element
            const li = document.createElement("li");
            li.textContent = tagText;
            li.className = "border border-black px-2 py-1 cursor-pointer w-fit";
            
            // Create hidden input for the form submission
            const hiddenInput = document.createElement("input");
            hiddenInput.type = "hidden";
            hiddenInput.name = "tags[]";
            hiddenInput.value = tagText;
            
            // Add delete functionality
            li.addEventListener("click", () => {
                li.remove();
                hiddenInput.remove();
            });
            
            // Add elements to the DOM
            taglist.appendChild(li);
            hiddenTagContainer.appendChild(hiddenInput);
            
            input.value = ""; // Clear input field
        }
    }

    input.addEventListener("keydown", (event) => {
        if (event.key === "Enter") {
            event.preventDefault(); // Prevent form submission
            addTag();
        }
    });

    tagbutton.addEventListener("click", (event) => {
        event.preventDefault(); // Prevent form submission
        addTag();
    });
    

    titleInput.addEventListener("input", adjustTitleWidth);
    
    titleInput.addEventListener("focus", function() {
        this.select();
    });
</script>